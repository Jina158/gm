<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fanruan.platform.mapper.CommonsMapper">

    <resultMap id="getBlackListResultMap" type="com.fanruan.platform.bean.BlackList">
        <result column="PID" jdbcType="VARCHAR" property="pid" />
        <result column="ENTNAME" jdbcType="VARCHAR" property="entName" />
        <result column="CODE" jdbcType="VARCHAR" property="code" />
        <result column="START_DATE" jdbcType="TIMESTAMP" property="startDate" />
        <result column="END_DATE" jdbcType="TIMESTAMP" property="endDate" />
        <result column="GRADE" jdbcType="VARCHAR" property="grade" />
        <result column="REASON" jdbcType="VARCHAR" property="reason" />
        <result column="REASON_URL" jdbcType="VARCHAR" property="reasonUrl" />
        <result column="PUBLISH_DEPT" jdbcType="VARCHAR" property="publishDept" />
        <result column="APPROVE_DEPT" jdbcType="VARCHAR" property="approveDept" />
        <result column="PUBLISH_TIME" jdbcType="TIMESTAMP" property="publishTime" />
        <result column="TYPE" jdbcType="VARCHAR" property="type" />
        <result column="STATUS" jdbcType="VARCHAR" property="status" />
        <result column="APPROVE_TIME" jdbcType="TIMESTAMP" property="approveTime" />
        <result column="UPDATEBY" jdbcType="VARCHAR" property="updateby" />
        <result column="CANCEL_BY" jdbcType="VARCHAR" property="cancelBy" />
        <result column="CANCEL_TIME" jdbcType="VARCHAR" property="cancelTime" />
        <result column="CANCEL_REASON" jdbcType="VARCHAR" property="cancelReason" />
    </resultMap>

    <select id="getBlackList" resultType="com.fanruan.platform.bean.BlackList">
        select * from INPUT_BLACKLIST where sysdate &lt;=add_months(start_date,1) and status=2
        and COMPANYNAME in (
        SELECT DISTINCT O.SUBCOMPANYNAME --二级公司
        FROM ODS_HR_PSNDOC A
        LEFT JOIN DIM_ORG O ON A.ORGCODE=O.SUBCOMPANYCODE
        WHERE  A.CODE=#{userCode}--用户名
        AND O.TP=2
        UNION
        SELECT DISTINCT O.SUBCOMPANYNAME --管理员
        FROM ODS_HR_PSNDOC A
        LEFT JOIN DIM_ORG O ON A.ORGCODE=O.SUBCOMPANYCODE
        WHERE  'admin'=#{userCode}--用户名
        AND O.TP IN (1,2)
        UNION
        SELECT DISTINCT O.SUBCOMPANYNAME --集团
        FROM DIM_ORG O
        WHERE  '浙江省国际贸易集团有限公司' =
        (
        SELECT DISTINCT O.SUBCOMPANYNAME --集团
        FROM ODS_HR_PSNDOC A
        LEFT JOIN DIM_ORG O ON A.ORGCODE=O.SUBCOMPANYCODE
        WHERE  A.CODE=#{userCode}--用户名
        AND O.TP=1
        )
        AND O.TP IN (1,2)
        )
    </select>

    <resultMap id="getUserCompanyResultMap" type="com.fanruan.platform.bean.UserCompany">
        <result column="CODE" jdbcType="VARCHAR" property="code" />
        <result column="NAME" jdbcType="VARCHAR" property="name" />
    </resultMap>

    <select id="getUserCompany" resultType="com.fanruan.platform.bean.UserCompany">
        with ds1 as(
            SELECT CODE,NAME,SCODE,SNAME FROM BIUSER.ODS_HR_ORG
            UNION
            SELECT CODE,NAME,SCODE,SNAME FROM BIUSER.INPUT_HR_ORG
            WHERE ENABLESTATE=1
        )
        SELECT CODE,NAME --自身
        FROM ds1 A
        WHERE  CODE=(SELECT COMPANY_CODE FROM CREDIT_USER WHERE USERNAME=#{username})
        UNION ALL
        SELECT CODE,NAME --下级公司
        FROM ds1 A
        WHERE SCODE=(SELECT COMPANY_CODE FROM CREDIT_USER WHERE USERNAME=#{username})
        UNION ALL
        SELECT B.CODE,B.NAME --下下级公司
        FROM ds1 A
                 INNER JOIN ds1 B ON A.CODE=B.SCODE
        WHERE A.SCODE=(SELECT COMPANY_CODE FROM CREDIT_USER WHERE USERNAME=#{username})
        UNION ALL
        SELECT C.CODE,C.NAME --下下下级公司
        FROM ds1 A
                 INNER JOIN ds1 B ON A.CODE=B.SCODE
                 INNER JOIN ds1 C ON B.CODE=C.SCODE
        WHERE A.SCODE=(SELECT COMPANY_CODE FROM CREDIT_USER WHERE USERNAME=#{username})
        UNION ALL
        SELECT D.CODE,D.NAME --下下下下级公司
        FROM ds1 A
                 INNER JOIN ds1 B ON A.CODE=B.SCODE
                 INNER JOIN ds1 C ON B.CODE=C.SCODE
                 INNER JOIN ds1 D ON C.CODE=D.SCODE
        WHERE A.SCODE=(SELECT COMPANY_CODE FROM CREDIT_USER WHERE USERNAME=#{username})
        order by code
    </select>

    <resultMap id="getZxbApplyListResultMap" type="com.fanruan.platform.bean.ZhongXinBaoLog">
        <result column="corpSerialNo" jdbcType="VARCHAR" property="corpSerialNo" />
        <result column="clientNo" jdbcType="VARCHAR" property="clientNo" />
        <result column="reportbuyerNo" jdbcType="VARCHAR" property="reportbuyerNo" />
        <result column="reportCorpCountryCode" jdbcType="VARCHAR" property="reportCorpCountryCode" />
        <result column="reportCorpChnName" jdbcType="VARCHAR" property="reportCorpChnName" />
        <result column="reportCorpEngName" jdbcType="VARCHAR" property="reportCorpEngName" />
        <result column="reportCorpaddress" jdbcType="VARCHAR" property="reportCorpaddress" />
        <result column="creditno" jdbcType="VARCHAR" property="creditno" />
        <result column="istranslation" jdbcType="VARCHAR" property="istranslation" />
        <result column="corpSerialNoOut" jdbcType="VARCHAR" property="corpSerialNoOut" />
        <result column="approveCode" jdbcType="VARCHAR" property="approveCode" />
        <result column="approveMsg" jdbcType="VARCHAR" property="approveMsg" />
        <result column="clientNoOut" jdbcType="VARCHAR" property="clientNoOut" />
        <result column="otherMsg" jdbcType="VARCHAR" property="otherMsg" />
        <result column="updateBy" jdbcType="VARCHAR" property="updateBy" />
        <result column="updateTime" jdbcType="TIMESTAMP" property="updateTime" />
        <result column="approveby" jdbcType="VARCHAR" property="approveby" />
        <result column="approveDate" jdbcType="TIMESTAMP" property="approveDate" />
        <result column="updateName" jdbcType="VARCHAR" property="updateName" />
        <result column="approveName" jdbcType="VARCHAR" property="approveName" />
    </resultMap>

    <select id="getZxbApplyList" resultType="com.fanruan.platform.bean.ZhongXinBaoLog">
        with ds1 as(
        SELECT CODE,NAME,SCODE,SNAME FROM BIUSER.ODS_HR_ORG
        UNION
        SELECT CODE,NAME,SCODE,SNAME FROM BIUSER.INPUT_HR_ORG
        )
        SELECT
        M.CORPSERIALNO_IMPORT as corpSerialNo,
        M.CLIENTNO_IMPORT as clientNo,
        M.REPORTBUYERNO as reportbuyerNo,
        M.REPORTCORPCOUNTRYCODE as reportCorpCountryCode,
        M.REPORTCORPCHNNAME as reportCorpChnName,
        M.REPORTCORPENGNAME as reportCorpEngName,
        M.REPORTCORPADDRESS as reportCorpaddress,
        M.CREDITNO as creditno,
        M.ISTRANSLATION as istranslation,
        M.CORPSERIALNO_EXPORT as corpSerialNoOut,
        M.APPROVECODE as approveCode,
        M.APPROVEMSG as approveMsg,
        M.CLIENTNO_EXPORT as clientNoOut,
        M.OTHERMSG as otherMsg,
        M.UPDATEBY as updateBy,
        M.UPDATETIME as updateTime,
        M.APPROVEBY as approveby,
        M.APPROVEDATE as approveDate,
        M.updateName as updateName,
        M.approveName as approveName
        FROM (SELECT ROWNUM AS rowno, N.*
        FROM (SELECT T.*,
        U.NAME as updateName,
        P.NAME as approveName
        FROM LOG_ZXB_APPLY T
        LEFT JOIN CREDIT_USER U ON T.UPDATEBY = U.USERNAME
        LEFT JOIN CREDIT_USER P ON T.APPROVEBY = P.USERNAME
        WHERE 1 = 1
        AND U.COMPANY_CODE IN (
        SELECT CODE --自身
        FROM ds1 A
        WHERE  CODE=(SELECT COMPANY_CODE FROM CREDIT_USER WHERE USERNAME=#{operator})
        UNION ALL
        SELECT CODE --下级公司
        FROM ds1 A
        WHERE SCODE=(SELECT COMPANY_CODE FROM CREDIT_USER WHERE USERNAME=#{operator})
        UNION ALL
        SELECT B.CODE --下下级公司
        FROM ds1 A
        INNER JOIN ds1 B ON A.CODE=B.SCODE
        WHERE A.SCODE=(SELECT COMPANY_CODE FROM CREDIT_USER WHERE USERNAME=#{operator})
        UNION ALL
        SELECT C.CODE --下下下级公司
        FROM ds1 A
        INNER JOIN ds1 B ON A.CODE=B.SCODE
        INNER JOIN ds1 C ON B.CODE=C.SCODE
        WHERE A.SCODE=(SELECT COMPANY_CODE FROM CREDIT_USER WHERE USERNAME=#{operator})
        UNION ALL
        SELECT D.CODE --下下下下级公司
        FROM ds1 A
        INNER JOIN ds1 B ON A.CODE=B.SCODE
        INNER JOIN ds1 C ON B.CODE=C.SCODE
        INNER JOIN ds1 D ON C.CODE=D.SCODE
        WHERE A.SCODE=(SELECT COMPANY_CODE FROM CREDIT_USER WHERE USERNAME=#{operator})
        )
        ORDER BY updateTime DESC) N
        WHERE 1 = 1
        <if test="zxbCode != null and zxbCode!=''">
            and (N.reportbuyerNo like '%'||#{zxbCode}||'%' )
        </if>
        <if test="zxbCompanyName != null and zxbCompanyName!='' ">
            and (N.reportCorpChnName like '%'||#{zxbCompanyName}||'%' OR N.reportCorpEngName like '%'||#{zxbCompanyName}||'%' )
        </if>
        <if test="approveCode != null and approveCode != ''">
            and (N.approveCode = #{approveCode})
        </if>
        <if test="zxbInformant != null and zxbInformant!=''">
            and (updateName like '%'||#{zxbInformant}||'%' )
        </if>
        <if test="zxbApprover != null and zxbApprover!=''">
            and (approveName like '%'||#{zxbApprover}||'%' )
        </if>
        ) M
        WHERE 1 = 1
        AND rowno &lt;= #{pageIndex} * #{pageSize}
        AND rowno &gt; (#{pageIndex}-1) * #{pageSize}
    </select>

    <resultMap id="getZxbApplyListCountResultMap" type="java.lang.Integer">
        <result column="co" jdbcType="VARCHAR" property="co" />
    </resultMap>

    <select id="getZxbApplyListCount" resultType="java.lang.Integer">
        with ds1 as(
        SELECT CODE,NAME,SCODE,SNAME FROM BIUSER.ODS_HR_ORG
        UNION
        SELECT CODE,NAME,SCODE,SNAME FROM BIUSER.INPUT_HR_ORG
        )
        select COUNT(1) from (
        SELECT
        M.CORPSERIALNO_IMPORT as corpSerialNo,
        M.CLIENTNO_IMPORT as clientNo,
        M.REPORTBUYERNO as reportbuyerNo,
        M.REPORTCORPCOUNTRYCODE as reportCorpCountryCode,
        M.REPORTCORPCHNNAME as reportCorpChnName,
        M.REPORTCORPENGNAME as reportCorpEngName,
        M.REPORTCORPADDRESS as reportCorpaddress,
        M.CREDITNO as creditno,
        M.ISTRANSLATION as istranslation,
        M.CORPSERIALNO_EXPORT as corpSerialNoOut,
        M.APPROVECODE as approveCode,
        M.APPROVEMSG as approveMsg,
        M.CLIENTNO_EXPORT as clientNoOut,
        M.OTHERMSG as otherMsg,
        M.UPDATEBY as updateBy,
        M.UPDATETIME as updateTime,
        M.APPROVEBY as approveby,
        M.APPROVEDATE as approveDate,
        M.updateName as updateName,
        M.approveName as approveName
        FROM (SELECT ROWNUM AS rowno, N.*
        FROM (SELECT T.*,
        U.NAME as updateName,
        P.NAME as approveName
        FROM LOG_ZXB_APPLY T
        LEFT JOIN CREDIT_USER U ON T.UPDATEBY = U.USERNAME
        LEFT JOIN CREDIT_USER P ON T.APPROVEBY = P.USERNAME
        WHERE 1 = 1
        AND U.COMPANY_CODE IN (
        SELECT CODE --自身
        FROM ds1 A
        WHERE  CODE=(SELECT COMPANY_CODE FROM CREDIT_USER WHERE USERNAME=#{operator})
        UNION ALL
        SELECT CODE --下级公司
        FROM ds1 A
        WHERE SCODE=(SELECT COMPANY_CODE FROM CREDIT_USER WHERE USERNAME=#{operator})
        UNION ALL
        SELECT B.CODE --下下级公司
        FROM ds1 A
        INNER JOIN ds1 B ON A.CODE=B.SCODE
        WHERE A.SCODE=(SELECT COMPANY_CODE FROM CREDIT_USER WHERE USERNAME=#{operator})
        UNION ALL
        SELECT C.CODE --下下下级公司
        FROM ds1 A
        INNER JOIN ds1 B ON A.CODE=B.SCODE
        INNER JOIN ds1 C ON B.CODE=C.SCODE
        WHERE A.SCODE=(SELECT COMPANY_CODE FROM CREDIT_USER WHERE USERNAME=#{operator})
        UNION ALL
        SELECT D.CODE --下下下下级公司
        FROM ds1 A
        INNER JOIN ds1 B ON A.CODE=B.SCODE
        INNER JOIN ds1 C ON B.CODE=C.SCODE
        INNER JOIN ds1 D ON C.CODE=D.SCODE
        WHERE A.SCODE=(SELECT COMPANY_CODE FROM CREDIT_USER WHERE USERNAME=#{operator})
        )
        ORDER BY updateTime DESC) N
        WHERE 1 = 1
        <if test="zxbCode != null and zxbCode!=''">
            and (N.reportbuyerNo like '%'||#{zxbCode}||'%' )
        </if>
        <if test="zxbCompanyName != null and zxbCompanyName!='' ">
            and (N.reportCorpChnName like '%'||#{zxbCompanyName}||'%' OR N.reportCorpEngName like '%'||#{zxbCompanyName}||'%' )
        </if>
        <if test="approveCode != null and approveCode != ''">
            and (N.approveCode = #{approveCode})
        </if>
        <if test="zxbInformant != null and zxbInformant!=''">
            and (updateName like '%'||#{zxbInformant}||'%' )
        </if>
        <if test="zxbApprover != null and zxbApprover!=''">
            and (approveName like '%'||#{zxbApprover}||'%' )
        </if>
        ) M
        WHERE 1 = 1
        )
    </select>

    <insert id="insertOAMsg" parameterType="java.util.List">
        insert into INPUT_PUSH(ID,USER_NAME,PUSH_FLAG,PUSH_TIME,PROMPTINFO,PUSH_TYPE) VALUES(lower(sys_guid())
                                                                                            ,#{updateBy}--填报人
                                                                                            ,'0'
                                                                                            ,SYSDATE
                                                                                            ,'您的信保报告申请已被'||#{approveBy}||'驳回，请重新申请。'--审核人
                                                                                            ,'信保报告审核')
    </insert>

    <resultMap id="getAllCompanyLevelResultMap" type="com.fanruan.platform.bean.CompanyLevel">
        <result column="code" jdbcType="VARCHAR" property="code" />
        <result column="name" jdbcType="VARCHAR" property="name" />
        <result column="scode" jdbcType="VARCHAR" property="scode" />
    </resultMap>
    <select id="getAllCompanyLevel" resultType="com.fanruan.platform.bean.CompanyLevel">
        SELECT CODE,NAME,SCODE,SNAME FROM BIUSER.ODS_HR_ORG
        where ENABLESTATE='2'
        <if test="companyCode != null and companyCode !=''">
            and (SCODE = #{companyCode})
        </if>
        UNION
        SELECT CODE,NAME,SCODE,SNAME FROM BIUSER.INPUT_HR_ORG
        WHERE ENABLESTATE='1'
        <if test="companyCode != null and companyCode !=''">
           and (SCODE = #{companyCode})
        </if>
    </select>

    <resultMap id="getCompanyLevelResultMap" type="com.fanruan.platform.bean.CompanyLevel">
        <result column="code" jdbcType="VARCHAR" property="code" />
        <result column="name" jdbcType="VARCHAR" property="name" />
        <result column="scode" jdbcType="VARCHAR" property="scode" />
    </resultMap>
    <select id="getCompanyLevel" resultType="com.fanruan.platform.bean.CompanyLevel">
        SELECT CODE,NAME,SCODE,SNAME FROM BIUSER.ODS_HR_ORG
        where ENABLESTATE='2'
        <if test="companyCode != null and companyCode !=''">
            and (CODE = #{companyCode})
        </if>
        UNION
        SELECT CODE,NAME,SCODE,SNAME FROM BIUSER.INPUT_HR_ORG
        WHERE ENABLESTATE='1'
        <if test="companyCode != null and companyCode !=''">
            and (CODE = #{companyCode})
        </if>
    </select>


    <resultMap id="getCompanyStatusResultMap" type="java.lang.String">
        <result column="flag" jdbcType="VARCHAR" property="flag" />
    </resultMap>
    <select id="getCompanyStatus" resultType="java.lang.String">
        SELECT CASE WHEN ENABLESTATE='2' THEN '1' ELSE '0' END AS FLAG FROM BIUSER.ODS_HR_ORG
        WHERE 1 = 1
        <if test="companyCode != null and companyCode !=''">
        and (CODE = #{companyCode})
        </if>
        UNION
        SELECT CASE WHEN ENABLESTATE='1' THEN '1' ELSE '0' END AS FLAG FROM BIUSER.INPUT_HR_ORG
        WHERE 1 = 1
        <if test="companyCode != null and companyCode !=''">
            and (CODE = #{companyCode})
        </if>
    </select>

    <resultMap id="getAllUpdataByResultMap" type="java.lang.String">
        <result column="UPDATEBY" jdbcType="VARCHAR" property="UPDATEBY" />
    </resultMap>
    <select id="getAllUpdataBy" resultType="java.lang.String">
        select DISTINCT UPDATEBY FROM INPUT_CUSTOM_HAND
    </select>

    <resultMap id="getAllSerialidResultMap" type="java.lang.String">
        <result column="SERIALID" jdbcType="VARCHAR" property="SERIALID" />
    </resultMap>
    <select id="getAllSerialid" resultType="java.lang.String">
        SELECT DISTINCT SERIALID from INPUT_CUSTOM_HAND where SERIALID like  #{updataBy}||'%'  order by to_number(REGEXP_SUBSTR(SERIALID,'[0-9]+')) desc
    </select>

    <resultMap id="getMerchantsViewResultsCountResultMap" type="java.lang.Integer">
        <result column="co" jdbcType="VARCHAR" property="co" />
    </resultMap>

    <select id="getMerchantsViewResultsCount" resultType="java.lang.Integer">
        WITH ds1 as(
        SELECT substr(b.ESTIBLISHTIME,0,10) AS DATE1,a.CUSTOM_SOCIAL_CODE,a.CUSTOM_NAME,b.*
        FROM "BIUSER"."INPUT_CUSTOM_HAND"  a
        inner join ODS_TYC_GSINFO b on a.CUSTOM_NAME = b.NAME
        where
        1=1
        <if test="updataBy != null and updataBy !=''">
            and (a.UPDATEBY = #{updataBy})
        </if>
        <if test="serialid != null and serialid !=''">
            and (a.SERIALID = #{serialid})
        </if>
        UNION
        SELECT substr(b.ESTIBLISHTIME,0,10) AS DATE1,a.CUSTOM_SOCIAL_CODE,a.CUSTOM_NAME,b.*
        FROM "BIUSER"."INPUT_CUSTOM_HAND"  a
        inner join ODS_TYC_GSINFO b on a.CUSTOM_NAME = b.INPUT_NAME
        where
        1=1
        <if test="updataBy != null and updataBy !=''">
            and (a.UPDATEBY = #{updataBy})
        </if>
        <if test="serialid != null and serialid !=''">
            and (a.SERIALID = #{serialid})
        </if>
        and b.NAME IS NOT NULL
        UNION
        SELECT '' AS DATE1
        ,a.CUSTOM_SOCIAL_CODE
        ,a.CUSTOM_NAME
        ,'' AS "ID"
        ,b.REASON AS "NAME"
        ,'' AS COMPANYORGTYPE
        ,'' AS REGCAPITAL
        ,'' AS ESTIBLISHTIME
        ,'' AS REGLOCATION
        ,'' AS INDUSTRY
        ,'' AS DS_CREDITCODE
        ,'' AS GS_CREDITCODE
        ,'' AS REGT_CREDIDTCODE
        ,'' AS REG_CREDIDTCODE
        ,'' AS FROMTIME
        ,'' AS TOTIME
        ,'' AS UPDATETIME
        ,'' AS CREDIT_CODE
        ,'' AS LEGALPERSONNAME
        ,'' AS BASE
        ,'' AS INVESTORNAME
        ,'' AS ETL_FLAG
        ,'' AS CREATETIME
        ,0 AS TIMES
        ,'' AS INPUT_NAME
        ,'' AS BUSINESS_SCOPE
        ,'' AS PHONE_NUMBER
        FROM "BIUSER"."INPUT_CUSTOM_HAND"  a
        inner join ODS_TYC_JSON b
        on a.CUSTOM_NAME = b.NAME
        where
        b.error_code > '0'
        <if test="updataBy != null and updataBy !=''">
            and (a.UPDATEBY = #{updataBy})
        </if>
        <if test="serialid != null and serialid !=''">
            and (a.SERIALID = #{serialid})
        </if>
        )
        SELECT COUNT (1) as co from  (SELECT a.CUSTOM_NAME as CUSTOM_NAME1,ds1.* from "BIUSER"."INPUT_CUSTOM_HAND" a
        LEFT JOIN ds1 on a.CUSTOM_NAME=ds1.CUSTOM_NAME
        where 1=1
        <if test="updataBy != null and updataBy !=''">
            and (a.UPDATEBY = #{updataBy})
        </if>
        <if test="serialid != null and serialid !=''">
            and (a.SERIALID = #{serialid})
        </if>
        )
    </select>

    <resultMap id="getMerchantsViewResultsResultMap" type="com.fanruan.platform.bean.MerchantsViewResults">
        <result column="customName1" jdbcType="VARCHAR" property="customName1"/>
        <result column="customSocialCode" jdbcType="VARCHAR" property="customSocialCode"/>
        <result column="name" jdbcType="VARCHAR" property="name"/>
        <result column="creditCode" jdbcType="VARCHAR" property="creditCode" />
        <result column="companyorgtype" jdbcType="VARCHAR" property="companyorgtype"/>
        <result column="industry" jdbcType="VARCHAR" property="industry"/>
        <result column="reglocation" jdbcType="VARCHAR" property="reglocation"/>
        <result column="businessScope" jdbcType="VARCHAR" property="businessScope"/>
        <result column="phoneNumber" jdbcType="VARCHAR" property="phoneNumber"/>
        <result column="regcapital" jdbcType="VARCHAR" property="regcapital"/>
        <result column="legalpersonname" jdbcType="VARCHAR" property="legalpersonname"/>
        <result column="estiblishtime" jdbcType="VARCHAR" property="estiblishtime" />
        <result column="fromtime" jdbcType="VARCHAR" property="fromtime"/>
        <result column="totime" jdbcType="VARCHAR" property="totime"/>
    </resultMap>
    <select id="getMerchantsViewResults" resultType="com.fanruan.platform.bean.MerchantsViewResults">
        WITH ds1 as(
        SELECT substr(b.ESTIBLISHTIME,0,10) AS DATE1,a.CUSTOM_SOCIAL_CODE,a.CUSTOM_NAME,b.*
        FROM "BIUSER"."INPUT_CUSTOM_HAND"  a
        inner join ODS_TYC_GSINFO b on a.CUSTOM_NAME = b.NAME
        where
        1=1
        <if test="updataBy != null and updataBy !=''">
            and (a.UPDATEBY = #{updataBy})
        </if>
        <if test="serialid != null and serialid !=''">
            and (a.SERIALID = #{serialid})
        </if>
        UNION
        SELECT substr(b.ESTIBLISHTIME,0,10) AS DATE1,a.CUSTOM_SOCIAL_CODE,a.CUSTOM_NAME,b.*
        FROM "BIUSER"."INPUT_CUSTOM_HAND"  a
        inner join ODS_TYC_GSINFO b on a.CUSTOM_NAME = b.INPUT_NAME
        where
        1=1
        <if test="updataBy != null and updataBy !=''">
            and (a.UPDATEBY = #{updataBy})
        </if>
        <if test="serialid != null and serialid !=''">
            and (a.SERIALID = #{serialid})
        </if>
            and b.NAME IS NOT NULL
        UNION
        SELECT '' AS DATE1
        ,a.CUSTOM_SOCIAL_CODE
        ,a.CUSTOM_NAME
        ,'' AS "ID"
        ,b.REASON AS "NAME"
        ,'' AS COMPANYORGTYPE
        ,'' AS REGCAPITAL
        ,'' AS ESTIBLISHTIME
        ,'' AS REGLOCATION
        ,'' AS INDUSTRY
        ,'' AS DS_CREDITCODE
        ,'' AS GS_CREDITCODE
        ,'' AS REGT_CREDIDTCODE
        ,'' AS REG_CREDIDTCODE
        ,'' AS FROMTIME
        ,'' AS TOTIME
        ,'' AS UPDATETIME
        ,'' AS CREDIT_CODE
        ,'' AS LEGALPERSONNAME
        ,'' AS BASE
        ,'' AS INVESTORNAME
        ,'' AS ETL_FLAG
        ,'' AS CREATETIME
        ,0 AS TIMES
        ,'' AS INPUT_NAME
        ,'' AS BUSINESS_SCOPE
        ,'' AS PHONE_NUMBER
        FROM "BIUSER"."INPUT_CUSTOM_HAND"  a
        inner join ODS_TYC_JSON b
        on a.CUSTOM_NAME = b.NAME
        where
        b.error_code > '0'
        <if test="updataBy != null and updataBy !=''">
            and (a.UPDATEBY = #{updataBy})
        </if>
        <if test="serialid != null and serialid !=''">
            and (a.SERIALID = #{serialid})
        </if>
        )
        SELECT M.* FROM (
        SELECT ROWNUM AS rowno,N.* from (
        SELECT a.CUSTOM_NAME as CUSTOM_NAME1,a.CUSTOM_SOCIAL_CODE as customSocialCode,ds1.* from "BIUSER"."INPUT_CUSTOM_HAND" a
        LEFT JOIN ds1 on a.CUSTOM_NAME=ds1.CUSTOM_NAME
        where 1=1
        <if test="updataBy != null and updataBy !=''">
            and (a.UPDATEBY = #{updataBy})
        </if>
        <if test="serialid != null and serialid !=''">
            and (a.SERIALID = #{serialid})
        </if>
        )N
        )M
        WHERE 1 = 1
        AND rowno &lt;= #{pageIndex} * #{pageSize}
        AND rowno &gt; (#{pageIndex}-1) * #{pageSize}
    </select>

    <resultMap id="getMerchantsViewExcelResultMap" type="com.fanruan.platform.bean.MerchantsViewResults">
        <result column="customName1" jdbcType="VARCHAR" property="customName1"/>
        <result column="customSocialCode" jdbcType="VARCHAR" property="customSocialCode"/>
        <result column="name" jdbcType="VARCHAR" property="name"/>
        <result column="creditCode" jdbcType="VARCHAR" property="creditCode" />
        <result column="companyorgtype" jdbcType="VARCHAR" property="companyorgtype"/>
        <result column="industry" jdbcType="VARCHAR" property="industry"/>
        <result column="reglocation" jdbcType="VARCHAR" property="reglocation"/>
        <result column="businessScope" jdbcType="VARCHAR" property="businessScope"/>
        <result column="phoneNumber" jdbcType="VARCHAR" property="phoneNumber"/>
        <result column="regcapital" jdbcType="VARCHAR" property="regcapital"/>
        <result column="legalpersonname" jdbcType="VARCHAR" property="legalpersonname"/>
        <result column="estiblishtime" jdbcType="VARCHAR" property="estiblishtime" />
        <result column="fromtime" jdbcType="VARCHAR" property="fromtime"/>
        <result column="totime" jdbcType="VARCHAR" property="totime"/>
    </resultMap>
    <select id="getMerchantsViewExcel" resultType="com.fanruan.platform.bean.MerchantsViewResults">
        WITH ds1 as(
        SELECT substr(b.ESTIBLISHTIME,0,10) AS DATE1,a.CUSTOM_SOCIAL_CODE,a.CUSTOM_NAME,b.*
        FROM "BIUSER"."INPUT_CUSTOM_HAND"  a
        inner join ODS_TYC_GSINFO b on a.CUSTOM_NAME = b.NAME
        where
        1=1
        <if test="updataBy != null and updataBy !=''">
            and (a.UPDATEBY = #{updataBy})
        </if>
        <if test="serialid != null and serialid !=''">
            and (a.SERIALID = #{serialid})
        </if>
        UNION
        SELECT substr(b.ESTIBLISHTIME,0,10) AS DATE1,a.CUSTOM_SOCIAL_CODE,a.CUSTOM_NAME,b.*
        FROM "BIUSER"."INPUT_CUSTOM_HAND"  a
        inner join ODS_TYC_GSINFO b on a.CUSTOM_NAME = b.INPUT_NAME
        where
        1=1
        <if test="updataBy != null and updataBy !=''">
            and (a.UPDATEBY = #{updataBy})
        </if>
        <if test="serialid != null and serialid !=''">
            and (a.SERIALID = #{serialid})
        </if>
        and b.NAME IS NOT NULL
        UNION
        SELECT '' AS DATE1
        ,a.CUSTOM_SOCIAL_CODE
        ,a.CUSTOM_NAME
        ,'' AS "ID"
        ,b.REASON AS "NAME"
        ,'' AS COMPANYORGTYPE
        ,'' AS REGCAPITAL
        ,'' AS ESTIBLISHTIME
        ,'' AS REGLOCATION
        ,'' AS INDUSTRY
        ,'' AS DS_CREDITCODE
        ,'' AS GS_CREDITCODE
        ,'' AS REGT_CREDIDTCODE
        ,'' AS REG_CREDIDTCODE
        ,'' AS FROMTIME
        ,'' AS TOTIME
        ,'' AS UPDATETIME
        ,'' AS CREDIT_CODE
        ,'' AS LEGALPERSONNAME
        ,'' AS BASE
        ,'' AS INVESTORNAME
        ,'' AS ETL_FLAG
        ,'' AS CREATETIME
        ,0 AS TIMES
        ,'' AS INPUT_NAME
        ,'' AS BUSINESS_SCOPE
        ,'' AS PHONE_NUMBER
        FROM "BIUSER"."INPUT_CUSTOM_HAND"  a
        inner join ODS_TYC_JSON b
        on a.CUSTOM_NAME = b.NAME
        where
        b.error_code > '0'
        <if test="updataBy != null and updataBy !=''">
            and (a.UPDATEBY = #{updataBy})
        </if>
        <if test="serialid != null and serialid !=''">
            and (a.SERIALID = #{serialid})
        </if>
        )
        SELECT a.CUSTOM_NAME as CUSTOM_NAME1,a.CUSTOM_SOCIAL_CODE as customSocialCode,ds1.* from "BIUSER"."INPUT_CUSTOM_HAND" a
        LEFT JOIN ds1 on a.CUSTOM_NAME=ds1.CUSTOM_NAME
        where 1=1
        <if test="updataBy != null and updataBy !=''">
            and (a.UPDATEBY = #{updataBy})
        </if>
        <if test="serialid != null and serialid !=''">
            and (a.SERIALID = #{serialid})
        </if>
    </select>

    <resultMap id="getAllBlackListResultListResultMap" type="com.fanruan.platform.bean.BlacklistResultList">
        <result column="pid" jdbcType="VARCHAR" property="pid" />
        <result column="entName" jdbcType="VARCHAR" property="entName" />
        <result column="startDate" jdbcType="VARCHAR" property="startDate" />
        <result column="reason" jdbcType="VARCHAR" property="reason" />
        <result column="grade" jdbcType="VARCHAR" property="grade" />
        <result column="publishBy" jdbcType="VARCHAR" property="publishBy" />
        <result column="publishDept" jdbcType="VARCHAR" property="publishDept" />
        <result column="publishTime" jdbcType="VARCHAR" property="publishTime" />
        <result column="status" jdbcType="VARCHAR" property="status" />
        <result column="reasonUrl" jdbcType="VARCHAR" property="reasonUrl" />
        <result column="type" jdbcType="VARCHAR" property="type" />
        <result column="creditCode" jdbcType="VARCHAR" property="creditCode" />
        <result column="approveBy" jdbcType="VARCHAR" property="approveBy" />
        <result column="approveTime" jdbcType="VARCHAR" property="approveTime" />
        <result column="operationSelection" jdbcType="VARCHAR" property="operationSelection" />
        <result column="reasonsForRenewal" jdbcType="VARCHAR" property="reasonsForRenewal" />
    </resultMap>
    <select id="getAllBlackListResultList" resultType="com.fanruan.platform.bean.BlacklistResultList">
        SELECT M.* FROM (
        SELECT ROWNUM AS rowno,N.* from (
        SELECT DISTINCT a.company_name,a.credit_code,b.* from CREDIT_COMPANY a
        left join
        "BIUSER"."INPUT_BLACKLIST" b on a.credit_code = B.code
        where
        1=1
        <if test="status != null and status.size > 0">
            and b.status in
            <foreach collection="status" index="index" item="item" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test="publishBy != null and publishBy !=''">
            and (b.PUBLISH_by = #{publishBy})
        </if>
        order by b.status,case when GRADE = '高' then 0
        when GRADE = '中' then 1
        else 3 end,b.UPDATETIME desc
        )N
        )M
        WHERE 1 = 1
        AND rowno &lt;= #{pageIndex} * #{pageSize}
        AND rowno &gt; (#{pageIndex}-1) * #{pageSize}
    </select>

    <resultMap id="getAllBlackListResultListCountResultMap" type="java.lang.Integer">
        <result column="co" jdbcType="VARCHAR" property="co" />
    </resultMap>
    <select id="getAllBlackListResultListCount" resultType="java.lang.Integer">
        SELECT COUNT (1) as co from  (
            SELECT DISTINCT a.company_name,a.credit_code,b.* from CREDIT_COMPANY a
            left join
            "BIUSER"."INPUT_BLACKLIST" b on a.credit_code = B.code
            where
            1=1
            <if test="status != null and status.size > 0">
                and b.status in
                <foreach collection="status" index="index" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>
            <if test="publishBy != null and publishBy !=''">
                and (b.PUBLISH_by = #{publishBy})
            </if>
            order by b.status,case when GRADE = '高' then 0
            when GRADE = '中' then 1
            else 3 end,b.UPDATETIME desc
        )
    </select>

    <resultMap id="getCompayNameAndCreditCodeResultMap" type="com.fanruan.platform.bean.CompayNameCode">
        <result column="companyName" jdbcType="VARCHAR" property="companyName" />
        <result column="creditCode" jdbcType="VARCHAR" property="creditCode" />
    </resultMap>
    <select id="getCompayNameAndCreditCode" resultType="com.fanruan.platform.bean.CompayNameCode">
        SELECT DISTINCT a.company_name,a.credit_code from CREDIT_COMPANY a
    </select>


    <resultMap id="getLevelCompanyNameResultMap" type="java.lang.String">
        <result column="COMPANYNAME" jdbcType="VARCHAR" property="COMPANYNAME" />
    </resultMap>
    <select id="getLevelCompanyName" resultType="java.lang.String">
        SELECT COMPANYNAME FROM VIEW_ORG
        WHERE COMPANYNAME IN
        (
        select COMPANYNAME from VIEW_ORG WHERE 1 = 1

        <if test="CompanyName != null and CompanyName !=''">
            and (SUBCOMPANYNAME = #{CompanyName})
        </if>
        )
        AND COMPANYNAME= SUBCOMPANYNAME
        AND TP = '2'
    </select>


    <resultMap id="getApproveByResultMap" type="java.lang.String">
        <result column="USERNAME" jdbcType="VARCHAR" property="USERNAME" />
    </resultMap>
    <select id="getApproveBy" resultType="java.lang.String">
        SELECT U.USERNAME
        FROM CREDIT_USER U
        WHERE U.ROLE_NAME = '审核专员'
        AND U.COMPANY_NAME IN
        (SELECT SUBCOMPANYNAME
        FROM VIEW_ORG
        WHERE COMPANYNAME =(SELECT COMPANYNAME FROM VIEW_ORG
        WHERE COMPANYNAME IN (select COMPANYNAME from VIEW_ORG
        WHERE 1 = 1
        <if test="approveBy != null and approveBy !=''">
            and (SUBCOMPANYNAME = #{approveBy})
        </if>
        )
        AND COMPANYNAME= SUBCOMPANYNAME
        AND TP = '2')
        )

    </select>

    <resultMap id="getAllHistoricalReportResultMap" type="com.fanruan.platform.bean.Report">
        <result column="reportId" jdbcType="INTEGER" property="reportId" />
        <result column="orderId" jdbcType="VARCHAR" property="orderId" />
        <result column="fileName" jdbcType="VARCHAR" property="fileName" />
        <result column="pdfName" jdbcType="VARCHAR" property="pdfName" />
        <result column="companyName" jdbcType="VARCHAR" property="companyName" />
        <result column="creditCode" jdbcType="VARCHAR" property="creditCode" />
        <result column="reportType" jdbcType="VARCHAR" property="reportType" />
        <result column="updateBy" jdbcType="VARCHAR" property="updateBy" />
        <result column="reportHtml" jdbcType="BLOB" property="reportHtml" />
        <result column="area" jdbcType="VARCHAR" property="area" />
        <result column="industry" jdbcType="VARCHAR" property="industry" />
        <result column="companyType" jdbcType="VARCHAR" property="companyType" />
        <result column="updateTime" jdbcType="TIMESTAMP" property="updateTime" />
    </resultMap>
    <select id="getAllHistoricalReport" resultType="com.fanruan.platform.bean.Report">
        SELECT * FROM
        (SELECT ROW_NUMBER() OVER(PARTITION BY report_type ORDER BY update_time DESC)rn, t.*FROM CREDIT_REPORT t
         where 1 = 1
        <if test="creditCode != null and creditCode !=''">
            and ( t.credit_code  = #{creditCode})
        </if>
         )
        WHERE rn = 1
    </select>

    <resultMap id="getBlacklistApprovalListResultMap" type="com.fanruan.platform.bean.BlacklistResultList">
        <result column="pid" jdbcType="VARCHAR" property="pid" />
        <result column="entName" jdbcType="VARCHAR" property="entName" />
        <result column="startDate" jdbcType="VARCHAR" property="startDate" />
        <result column="reason" jdbcType="VARCHAR" property="reason" />
        <result column="grade" jdbcType="VARCHAR" property="grade" />
        <result column="publishBy" jdbcType="VARCHAR" property="publishBy" />
        <result column="publishDept" jdbcType="VARCHAR" property="publishDept" />
        <result column="publishTime" jdbcType="VARCHAR" property="publishTime" />
        <result column="status" jdbcType="VARCHAR" property="status" />
        <result column="reasonUrl" jdbcType="VARCHAR" property="reasonUrl" />
        <result column="type" jdbcType="VARCHAR" property="type" />
        <result column="creditCode" jdbcType="VARCHAR" property="creditCode" />
        <result column="approveBy" jdbcType="VARCHAR" property="approveBy" />
        <result column="approveTime" jdbcType="VARCHAR" property="approveTime" />
        <result column="operationSelection" jdbcType="VARCHAR" property="operationSelection" />
        <result column="reasonsForRenewal" jdbcType="VARCHAR" property="reasonsForRenewal" />
        <result column="approveRemarks" jdbcType="VARCHAR" property="approveRemarks" />
        <result column="cancelBy" jdbcType="VARCHAR" property="cancelBy" />
        <result column="cancelTime" jdbcType="VARCHAR" property="cancelTime" />
        <result column="cancelReason" jdbcType="VARCHAR" property="cancelReason"/>
    </resultMap>
    <select id="getBlacklistApprovalList" resultType="com.fanruan.platform.bean.BlacklistResultList">
        SELECT M.* FROM (
        SELECT ROWNUM AS rowno,N.* from (
       SELECT DISTINCT
	    a.company_name,
	    a.credit_code,
	    b.*
        FROM
	    CREDIT_COMPANY a
	    LEFT JOIN "BIUSER"."INPUT_BLACKLIST" b ON a.credit_code = B.code
        WHERE
	    1 = 1
        <if test="status != null and status.size > 0">
            and b.status in
            <foreach collection="status" index="index" item="item" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
		AND b.PID IS NOT NULL
		AND b.status != 4
        AND b.companyname in
        (
        SELECT DISTINCT O.SUBCOMPANYNAME --二级公司
        FROM ODS_HR_PSNDOC A
        LEFT JOIN VIEW_ORG O ON A.ORGCODE=O.SUBCOMPANYCODE
        WHERE  A.CODE=#{userName}
        AND O.TP IN (1,2)
        UNION
        SELECT DISTINCT O.SUBCOMPANYNAME --管理员
        FROM  VIEW_ORG O
        WHERE #{userName} = 'admin'
        AND O.TP IN (1,2)
        )
	ORDER BY
		b.status,
	CASE

			WHEN GRADE = '高' THEN
			0
			WHEN GRADE = '中' THEN
			1 ELSE 3
		END,
	b.UPDATETIME DESC
        )N
        )M
        WHERE 1 = 1
        AND rowno &lt;= #{pageIndex} * #{pageSize}
        AND rowno &gt; (#{pageIndex}-1) * #{pageSize}
    </select>

    <resultMap id="getBlacklistApprovalListCountResultMap" type="java.lang.Integer">
        <result column="co" jdbcType="VARCHAR" property="co" />
    </resultMap>
    <select id="getBlacklistApprovalListCount" resultType="java.lang.Integer">
        SELECT COUNT (1) as co from  (
        SELECT DISTINCT
        a.company_name,
        a.credit_code,
        b.*
        FROM
        CREDIT_COMPANY a
        LEFT JOIN "BIUSER"."INPUT_BLACKLIST" b ON a.credit_code = B.code
        WHERE
        1 = 1
        <if test="status != null and status.size > 0">
            and b.status in
            <foreach collection="status" index="index" item="item" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        AND b.PID IS NOT NULL
        AND b.status != 4
        and b.companyname in
        (
        SELECT DISTINCT O.SUBCOMPANYNAME --二级公司
        FROM ODS_HR_PSNDOC A
        LEFT JOIN VIEW_ORG O ON A.ORGCODE=O.SUBCOMPANYCODE
        WHERE  A.CODE=#{userName}
        AND O.TP IN (1,2)
        UNION
        SELECT DISTINCT O.SUBCOMPANYNAME --管理员
        FROM  VIEW_ORG O
        WHERE #{userName} = 'admin'
        AND O.TP IN (1,2)
        )
        ORDER BY
        b.status,
        CASE

        WHEN GRADE = '高' THEN
        0
        WHEN GRADE = '中' THEN
        1 ELSE 3
        END,
        b.UPDATETIME DESC
        )
    </select>

    <resultMap id="getBlacklistApprovalExcelResultMap" type="com.fanruan.platform.bean.BlacklistResultList">
        <result column="pid" jdbcType="VARCHAR" property="pid" />
        <result column="entName" jdbcType="VARCHAR" property="entName" />
        <result column="startDate" jdbcType="VARCHAR" property="startDate" />
        <result column="reason" jdbcType="VARCHAR" property="reason" />
        <result column="grade" jdbcType="VARCHAR" property="grade" />
        <result column="publishBy" jdbcType="VARCHAR" property="publishBy" />
        <result column="publishDept" jdbcType="VARCHAR" property="publishDept" />
        <result column="publishTime" jdbcType="VARCHAR" property="publishTime" />
        <result column="status" jdbcType="VARCHAR" property="status" />
        <result column="reasonUrl" jdbcType="VARCHAR" property="reasonUrl" />
        <result column="type" jdbcType="VARCHAR" property="type" />
        <result column="creditCode" jdbcType="VARCHAR" property="creditCode" />
        <result column="approveBy" jdbcType="VARCHAR" property="approveBy" />
        <result column="approveTime" jdbcType="VARCHAR" property="approveTime" />
        <result column="operationSelection" jdbcType="VARCHAR" property="operationSelection" />
        <result column="reasonsForRenewal" jdbcType="VARCHAR" property="reasonsForRenewal" />
        <result column="approveRemarks" jdbcType="VARCHAR" property="approveRemarks" />
        <result column="cancelBy" jdbcType="VARCHAR" property="cancelBy" />
        <result column="cancelTime" jdbcType="VARCHAR" property="cancelTime" />
        <result column="cancelReason" jdbcType="VARCHAR" property="cancelReason"/>
    </resultMap>
    <select id="getBlacklistApprovalExcel" resultType="com.fanruan.platform.bean.BlacklistResultList">
        SELECT DISTINCT
        a.company_name,
        a.credit_code,
        b.*
        FROM
        CREDIT_COMPANY a
        LEFT JOIN "BIUSER"."INPUT_BLACKLIST" b ON a.credit_code = B.code
        WHERE
        1 = 1
        <if test="status != null and status.size > 0">
            and b.status in
            <foreach collection="status" index="index" item="item" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        AND b.PID IS NOT NULL
        AND b.status != 4
        AND b.companyname in
        (
        SELECT DISTINCT O.SUBCOMPANYNAME --二级公司
        FROM ODS_HR_PSNDOC A
        LEFT JOIN VIEW_ORG O ON A.ORGCODE=O.SUBCOMPANYCODE
        WHERE  A.CODE=#{userName}
        AND O.TP IN (1,2)
        UNION
        SELECT DISTINCT O.SUBCOMPANYNAME --管理员
        FROM  VIEW_ORG O
        WHERE #{userName} = 'admin'
        AND O.TP IN (1,2)
        )
        ORDER BY
        b.status,
        CASE

        WHEN GRADE = '高' THEN
        0
        WHEN GRADE = '中' THEN
        1 ELSE 3
        END,
        b.UPDATETIME DESC

    </select>

</mapper>

